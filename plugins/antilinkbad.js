const fs=require('fs');const path=require('path');const{readEnv}=require('../lib/database');const{cmd,commands}=require('../command');const{fetchJson}=require('../lib/functions');let userWarnings={};cmd({on:"body"},async(conn,mek,m,{from,body,isCmd,isGroup,isOwner,isAdmins,groupAdmins,isBotAdmins,sender,pushname,groupName,quoted})=>{try{const config=await readEnv();const botOwner=config.OWNER_NUMBER;const maxWarnings=config.WARN_COUNT||10;if(!userWarnings[sender]){userWarnings[sender]=0;}const sendAlertToOwner=async(triggerType,groupName,sender,message,action)=>{const alertMessage=`üö® ${triggerType} triggered in ${groupName}\nSender: @${sender.split('@')[0]}\nMessage: ${message}\nAction: ${action}`;await conn.sendMessage(botOwner,{text:alertMessage,mentions:[sender]});};const handleWarnings=async(type,maxWarnings)=>{userWarnings[sender]+=1;let action='warn';if(userWarnings[sender]>=maxWarnings){await conn.sendMessage(from,{text:`ùóïùó¨ùóò ~*@${sender.split('@')[0]}*~`,mentions:[sender]});await conn.groupParticipantsUpdate(from,[sender],'remove');action='kick';userWarnings[sender]=0;const kickMessage=`ùóõùó≤ùòÜ @${sender.split('@')[0]},\nùó¨ùóºùòÇùóø ùóûùóúùóñùóûùóòùóó ùó≥ùóøùóºùó∫ *${groupName}* ùó¥ùóøùóºùòÇùóΩ.\nùó•ùó≤ùóÆùòÄùóºùóª: ${body}`;await conn.sendMessage(sender,{text:kickMessage,mentions:[sender]});}else{const remainingWarnings=maxWarnings-userWarnings[sender];const warnCountMessage=`üë∫ ~*@${sender.split('@')[0]}*~\n*‚ö†Ô∏è ${type.toUpperCase()} DELETED: ‚ÄºÔ∏è*\nüö´ *ùó™ùóîùó•ùó° ùóñùó¢ùó®ùó°ùóß : ${remainingWarnings}/${maxWarnings}*`;await conn.sendMessage(from,{text:warnCountMessage,mentions:[sender]});}await sendAlertToOwner(type.toUpperCase(),groupName,sender,body,action);};if(config.ANTI_BAD==='delete'||config.ANTI_BAD==='warn'||config.ANTI_BAD==='kick'){const badWordsBlacklist=["fuc","huk","hut","ponn","pinn","paca","‡∑Ñ‡∑î‡∂ö","‡∑Ñ‡∑î‡∂≠‡∑ä","‡∂Ö‡∂∏‡∑ä‡∂∏","‡∂Ö‡∂∂‡∑í‡∑É‡∑è‡∂ª‡∑í","Wutt","Wuka","‡∑Ä‡∑ö‡∑É‡∑í","wesi","vesi","‡∂¥‡∑î‡∂ö","puk","‡∂ö‡∑í‡∂∏‡∑ä‡∂∂","ammata","‡∂ö‡∑ê‡∂ª‡∑í","pak","‡∂Ö‡∑Ä‡∂¢‡∑è‡∂≠","awaja","avaja","ammata","ponyo","‡∂¥‡∂ö","pky","‡∂¥‡∑ú‡∂±‡∑ä‡∂±","‡∂¥‡∂ú","kari","Htto","Hkpn","Utto","‡∂±‡∑ä‡∂±‡∂∫‡∑è","‡∑Ä‡∂¢‡∑è‡∂≠‡∂∫‡∑è","‡∑Ä‡∑ö‡∑É","‡∂±‡∂ú‡∑í‡∂±‡∑ä‡∂±‡∑ë"];const containsBadWord=badWordsBlacklist.some(word=>body.toLowerCase().includes(word));if(containsBadWord){if(isGroup){if(isBotAdmins){const senderIsAdmin=groupAdmins.includes(sender);if(!senderIsAdmin&&!isOwner){const key={remoteJid:from,fromMe:false,id:mek.key.id,participant:sender};await conn.sendMessage(from,{delete:key});if(config.ANTI_BAD==='warn'){await handleWarnings("BAD WORD",maxWarnings);}else if(config.ANTI_BAD==='kick'){await conn.sendMessage(from,{text:`üë∫ ~*@${sender.split('@')[0]}*~\n*‚ö†Ô∏è BAD WORD DELETED: ‚ÄºÔ∏è*\nüö´ *ùóûùóúùóñùóû ùó¶ùóòùó°ùóóùóòùó•*`,mentions:[sender]});await conn.groupParticipantsUpdate(from,[sender],'remove');await sendAlertToOwner("Bad word",groupName,sender,body,"kick");const kickMessage=`ùóõùó≤ùòÜ @${sender.split('@')[0]},\nùó¨ùóºùòÇùóø ùóûùóúùóñùóûùóòùóó ùó≥ùóøùóºùó∫ *${groupName}* ùó¥ùóøùóºùòÇùóΩ.\nùó•ùó≤ùóÆùòÄùóºùóª: ${body}`;await conn.sendMessage(sender,{text:kickMessage,mentions:[sender]});}else{await conn.sendMessage(from,{text:`üë∫ ~*@${sender.split('@')[0]}*~\n*‚ö†Ô∏è BAD WORD DELETED: ‚ÄºÔ∏è*`,mentions:[sender]});await sendAlertToOwner("Bad word",groupName,sender,body,"delete");}}}else{const adminsMention=groupAdmins.map(admin=>`@${admin.split('@')[0]}`).join(' ');const botNotAdminMessage=`‚ö†Ô∏è DilaMD bot does not have admin privileges, but bad words were detected.`;await conn.sendMessage(from,{text:botNotAdminMessage,mentions:groupAdmins});}}}}if(config.ANTI_LINK==='delete'||config.ANTI_LINK==='warn'||config.ANTI_LINK==='kick'){const linksBlacklist=["wa.me","chat.whatsapp.com","whatsapp.com","www.tiktok.com/@","youtube.com/@","whatspp.gruop"];const containsBlacklistedLink=linksBlacklist.some(word=>body.toLowerCase().includes(word));if(containsBlacklistedLink){if(isGroup){if(isBotAdmins){const senderIsAdmin=groupAdmins.includes(sender);if(!senderIsAdmin&&!isOwner){const key={remoteJid:from,fromMe:false,id:mek.key.id,participant:sender};await conn.sendMessage(from,{delete:key});if(config.ANTI_LINK==='warn'){await handleWarnings("LINK",maxWarnings);}else if(config.ANTI_LINK==='kick'){await conn.sendMessage(from,{text:`üë∫ ~*@${sender.split('@')[0]}*~\n*‚ö†Ô∏è LINK DELETED: ‚ÄºÔ∏è*\nüö´ *ùóûùóúùóñùóû ùó¶ùóòùó°ùóóùóòùó•*`,mentions:[sender]});await conn.groupParticipantsUpdate(from,[sender],'remove');await sendAlertToOwner("Antilink",groupName,sender,body,"kick");const kickMessage=`ùóõùó≤ùòÜ @${sender.split('@')[0]},\nùó¨ùóºùòÇùóø ùóûùóúùóñùóûùóòùóó ùó≥ùóøùóºùó∫ *${groupName}* ùó¥ùóøùóºùòÇùóΩ.\nùó•ùó≤ùóÆùòÄùóºùóª: ${body}`;await conn.sendMessage(sender,{text:kickMessage,mentions:[sender]});}else{await conn.sendMessage(from,{text:`üë∫ ~*@${sender.split('@')[0]}*~\n*‚ö†Ô∏è LINK DELETED: ‚ÄºÔ∏è*`,mentions:[sender]});await sendAlertToOwner("Antilink",groupName,sender,body,"delete");}}}else{const adminsMention=groupAdmins.map(admin=>`@${admin.split('@')[0]}`).join(' ');const botNotAdminMessage=`‚ö†Ô∏è DilaMD bot does not have admin privileges, but a link was detected.`;await conn.sendMessage(from,{text:botNotAdminMessage,mentions:groupAdmins});}}}}}catch(e){console.error(`Error in auto-delete functionality: ${e.message}`);const botOwner=config.OWNER_NUMBER;await conn.sendMessage(botOwner,{text:`‚ö†Ô∏è Error occurred in auto-delete functionality: ${e.message}`});}});
